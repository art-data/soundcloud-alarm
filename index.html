<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>SDK playground - Streaming</title>
    <link rel="stylesheet" href="css/sc-player-standard.css" type="text/css">
    <style media="screen">
      body {
        display: flex;
        flex-direction: column;
        align-items: center;
        font-family: sans-serif;
      }
      input {
        font-size: 20px;
      }
      #info {
        display: none;
      }
      input, p {
        width: 90%;
        margin-bottom: 10px;
        margin-top: 0;
      }
      @media (min-width: 500px) {
        input, p {
          width: 500px;
        }
      }
    </style>
  </head>
  <body>
    <form id="timeForm">
      <input id="date" type="datetime-local">
    </form>
    <h2>
      <br>https://soundcloud.com/yungnoize/i-like-lsd
      <br>https://soundcloud.com/violet-forest/likes
    </h2>
    <form id="searchForm">
      <input type="text" id="url" placeholder="A track's URL" autofocus />
    </form>
    <button onclick="checkTimeAndSetTimeout()">GO!</button>
    <div id="info">
      <span id="title"></span>
      <button id="play">play</button>
      <button id="pause">pause</button>
    </div>

    <script type="text/javascript" src="http://code.jquery.com/jquery.js"></script>
    <script type="text/javascript" src="js/soundcloud.player.api.js"></script>
    <script type="text/javascript" src="js/sc-player.js"></script>

    <script type="text/javascript">
      // // initializing a thing
      // SC.initialize({
      //   client_id: '4e34e0ce2f08f7a3107c9efdd4a61970'
      // });

      // getting some stuff from the html
      var dateTimeField = document.getElementById('date');
      var inputField = document.getElementById('url');
      var title = document.getElementById('title');
      var info = document.getElementById('info');

      function checkTime () {
        var unadjustedDateFromTheForm = dateTimeField.value
        console.log("unadjustedDateFromTheForm", unadjustedDateFromTheForm)
        var theDateTimeFromTheForm = new Date(unadjustedDateFromTheForm.replace(/-/g,'/').replace('T',' '))
        console.log("theDateTimeFromTheForm", theDateTimeFromTheForm)
        var timeLeft = theDateTimeFromTheForm - new Date()
        return timeLeft
      }

      function checkTimeAndSetTimeout () {
        console.log("pressed go")
        var timeLeft = checkTime()
        console.log("time left", timeLeft)
        // setTimeout(createPlayer, timeLeft)
        createPlayer(timeLeft)
        // setTimeout(createPlayer, 0)
      }

      // create player when the user clicks submit
      function createPlayer (timeLeft) {
        console.log('creating a player for ' + inputField.value)
        $('body').append('<a class="sc-player" href=' + inputField.value + ">player</a>")
        var playerrrr = $('a.sc-player, div.sc-player').scPlayer()
        setTimeout(findThePlayButtonAndClickOnIt, 1000)
        setTimeout(findThePlayButtonAndClickOnIt, 5000)
        setTimeout(findThePlayButtonAndClickOnIt, 10000 + timeLeft)
        // findThePlayButtonAndClickOnIt()
      }

      function findThePlayButtonAndClickOnIt () {
        console.log('clicking play')
        // make button clickable on ios
        $('a.sc-play').css('cursor','pointer')

        $('a.sc-play').trigger('click')
      }
    </script>
  </body>
</html>
